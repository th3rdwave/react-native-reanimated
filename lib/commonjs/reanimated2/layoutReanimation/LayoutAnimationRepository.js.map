{"version":3,"names":["runOnUI","configs","enteringAnimationForTag","global","LayoutAnimationRepository","registerConfig","tag","config","removeConfig","shouldAnimate","type","startAnimationForTag","yogaValues","style","currentAnimation","animations","entryAniamtion","layoutAnimation","key","sv","_stopObservingProgress","_startObservingProgress","backupColor","initialValues","ColorProperties","includes","value","processColor","Object","assign","_value","animation","withStyleAnimation","callback","finished"],"sources":["LayoutAnimationRepository.ts"],"sourcesContent":["/* global _stopObservingProgress, _startObservingProgress */\nimport { runOnUI } from '../core';\nimport { withStyleAnimation } from '../animation/styleAnimation';\nimport { ColorProperties } from '../UpdateProps';\nimport { processColor } from '../Colors';\n\nrunOnUI(() => {\n  'worklet';\n\n  const configs: Record<string, any> = {};\n  const enteringAnimationForTag: Record<string, any> = {};\n\n  global.LayoutAnimationRepository = {\n    configs,\n    registerConfig(tag, config) {\n      configs[tag] = config;\n      enteringAnimationForTag[tag] = null;\n    },\n    removeConfig(tag) {\n      delete configs[tag];\n      delete enteringAnimationForTag[tag];\n    },\n    shouldAnimate(tag, type) {\n      return configs[tag] != null;\n    },\n    startAnimationForTag(tag, type, yogaValues) {\n      if (configs[tag] == null) {\n        return; // :(\n      }\n      const style = configs[tag][type](yogaValues);\n      let currentAnimation = style.animations;\n      if (type === 'entering') {\n        enteringAnimationForTag[tag] = style;\n      } else if (type === 'layout' && enteringAnimationForTag[tag] !== null) {\n        const entryAniamtion = enteringAnimationForTag[tag].animations;\n        const layoutAnimation = style.animations;\n        currentAnimation = {};\n        for (const key in entryAniamtion) {\n          currentAnimation[key] = entryAniamtion[key];\n        }\n        for (const key in layoutAnimation) {\n          currentAnimation[key] = layoutAnimation[key];\n        }\n      }\n\n      const sv: { value: boolean; _value: boolean } = configs[tag].sv;\n      _stopObservingProgress(tag, false);\n      _startObservingProgress(tag, sv);\n\n      const backupColor: Record<string, string> = {};\n      for (const key in style.initialValues) {\n        if (ColorProperties.includes(key)) {\n          const value = style.initialValues[key];\n          backupColor[key] = value;\n          style.initialValues[key] = processColor(value);\n        }\n      }\n\n      sv.value = Object.assign({}, sv._value, style.initialValues);\n      _stopObservingProgress(tag, false);\n      const animation = withStyleAnimation(currentAnimation);\n\n      animation.callback = (finished?: boolean) => {\n        if (finished) {\n          _stopObservingProgress(tag, finished);\n        }\n        style.callback && style.callback(finished);\n      };\n\n      if (backupColor) {\n        configs[tag].sv._value = { ...configs[tag].sv.value, ...backupColor };\n      }\n\n      configs[tag].sv.value = animation;\n      _startObservingProgress(tag, sv);\n    },\n  };\n})();\n"],"mappings":"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"}