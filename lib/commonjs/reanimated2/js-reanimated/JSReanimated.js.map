{"version":3,"names":["JSReanimated","NativeReanimated","constructor","undefined","MapperRegistry","isJest","timeProvider","now","global","ReanimatedDataMock","window","performance","pushFrame","frame","_frames","push","maybeRequestRender","getTimestamp","_renderRequested","requestAnimationFrame","_timestampMs","_onRender","timestampMs","_mapperRegistry","execute","frames","i","len","length","needRunOnRender","installCoreFunctions","valueSetter","_valueSetter","makeShareable","value","makeMutable","MutableValue","makeRemote","object","startMapper","mapper","inputs","outputs","instance","Mapper","mapperId","stopMapper","registerEventHandler","_","__","unregisterEventHandler","enableLayoutAnimations","console","warn","registerSensor","unregisterSensor","jestResetModule","Error","subscribeForKeyboardEvents","unsubscribeFromKeyboardEvents"],"sources":["JSReanimated.ts"],"sourcesContent":["import MapperRegistry from './MapperRegistry';\nimport Mapper from './Mapper';\nimport MutableValue from './MutableValue';\nimport { NativeReanimated } from '../NativeReanimated/NativeReanimated';\nimport {\n  Timestamp,\n  NestedObjectValues,\n  AnimatedKeyboardInfo,\n} from '../commonTypes';\nimport { isJest } from '../PlatformChecker';\n\nexport default class JSReanimated extends NativeReanimated {\n  _valueSetter?: <T>(value: T) => void = undefined;\n\n  _renderRequested = false;\n  _mapperRegistry: MapperRegistry<any> = new MapperRegistry(this);\n  _frames: ((timestamp: Timestamp) => void)[] = [];\n  timeProvider: { now: () => number };\n\n  constructor() {\n    super(false);\n    if (isJest()) {\n      this.timeProvider = { now: () => global.ReanimatedDataMock.now() };\n    } else {\n      this.timeProvider = { now: () => window.performance.now() };\n    }\n  }\n\n  pushFrame(frame: (timestamp: Timestamp) => void): void {\n    this._frames.push(frame);\n    this.maybeRequestRender();\n  }\n\n  getTimestamp(): number {\n    return this.timeProvider.now();\n  }\n\n  maybeRequestRender(): void {\n    if (!this._renderRequested) {\n      this._renderRequested = true;\n\n      requestAnimationFrame((_timestampMs) => {\n        this._renderRequested = false;\n\n        this._onRender(this.getTimestamp());\n      });\n    }\n  }\n\n  _onRender(timestampMs: number): void {\n    this._mapperRegistry.execute();\n\n    const frames = [...this._frames];\n    this._frames = [];\n\n    for (let i = 0, len = frames.length; i < len; ++i) {\n      frames[i](timestampMs);\n    }\n\n    if (this._mapperRegistry.needRunOnRender) {\n      this._mapperRegistry.execute();\n    }\n  }\n\n  installCoreFunctions(valueSetter: <T>(value: T) => void): void {\n    this._valueSetter = valueSetter;\n  }\n\n  makeShareable<T>(value: T): T {\n    return value;\n  }\n\n  makeMutable<T>(value: T): MutableValue<T> {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return new MutableValue(value, this._valueSetter!);\n  }\n\n  makeRemote<T>(object = {}): T {\n    return object as T;\n  }\n\n  startMapper(\n    mapper: () => void,\n    inputs: NestedObjectValues<MutableValue<unknown>>[] = [],\n    outputs: NestedObjectValues<MutableValue<unknown>>[] = []\n  ): number {\n    const instance = new Mapper(this, mapper, inputs, outputs);\n    const mapperId = this._mapperRegistry.startMapper(instance);\n    this.maybeRequestRender();\n    return mapperId;\n  }\n\n  stopMapper(mapperId: number): void {\n    this._mapperRegistry.stopMapper(mapperId);\n  }\n\n  registerEventHandler<T>(_: string, __: (event: T) => void): string {\n    // noop\n    return '';\n  }\n\n  unregisterEventHandler(_: string): void {\n    // noop\n  }\n\n  enableLayoutAnimations() {\n    console.warn(\n      '[Reanimated] enableLayoutAnimations is not available for WEB yet'\n    );\n  }\n\n  registerSensor(): number {\n    console.warn('[Reanimated] useAnimatedSensor is not available on web yet.');\n    return -1;\n  }\n\n  unregisterSensor(): void {\n    // noop\n  }\n\n  jestResetModule() {\n    if (isJest()) {\n      /**\n       * If someone used timers to stop animation before the end,\n       * then _renderRequested was set as true\n       * and any new update from another test wasn't applied.\n       */\n      this._renderRequested = false;\n    } else {\n      throw Error('This method can be only use in Jest testing.');\n    }\n  }\n\n  subscribeForKeyboardEvents(_: AnimatedKeyboardInfo): number {\n    console.warn(\n      '[Reanimated] useAnimatedKeyboard is not available on web yet.'\n    );\n    return -1;\n  }\n\n  unsubscribeFromKeyboardEvents(_: number): void {\n    // noop\n  }\n}\n"],"mappings":"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"}