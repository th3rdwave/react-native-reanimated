{"version":3,"names":["_defineProperty","obj","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","NativeEventEmitter","NativeModules","findNodeHandle","isWeb","nativeShouldBeMock","IS_WEB","getViewTagForComponent","animatedComponent","_component","JSPropUpdater","_listener","data","component","_tagToComponentMapping","get","viewTag","_updateFromNative","props","constructor","reanimatedModule","_reanimatedModuleMock","ReanimatedModule","_reanimatedEventEmitter","addOnJSPropsChangeListener","set","size","addListener","removeOnJSPropsChangeListener","delete","removeAllListeners","Map","removeListeners"],"sources":["JSPropUpdater.ts"],"sourcesContent":["'use strict';\nimport {\n  NativeEventEmitter,\n  NativeModules,\n  findNodeHandle,\n} from 'react-native';\nimport { isWeb, nativeShouldBeMock } from '../reanimated2/PlatformChecker';\nimport type { StyleProps } from '../reanimated2';\nimport type {\n  AnimatedComponentProps,\n  IAnimatedComponentInternal,\n  IJSPropUpdater,\n  InitialComponentProps,\n} from './commonTypes';\n\ninterface ListenerData {\n  viewTag: number;\n  props: StyleProps;\n}\n\ninterface WebAnimatedComponent<P, S> extends React.Component<P, S> {\n  _component: HTMLElement;\n}\n\nconst IS_WEB = isWeb();\n\nfunction getViewTagForComponent<P, S>(\n  animatedComponent: React.Component<P, S>\n) {\n  return IS_WEB\n    ? (animatedComponent as WebAnimatedComponent<P, S>)._component\n    : findNodeHandle(animatedComponent);\n}\n\nexport class JSPropUpdater implements IJSPropUpdater {\n  private static _tagToComponentMapping = new Map();\n  private _reanimatedEventEmitter: NativeEventEmitter;\n  private static _reanimatedModuleMock = {\n    async addListener(): Promise<void> {\n      // noop\n    },\n    async removeListeners(): Promise<void> {\n      // noop\n    },\n  };\n\n  private static _listener(data: ListenerData) {\n    const component = JSPropUpdater._tagToComponentMapping.get(data.viewTag);\n    component && component._updateFromNative(data.props);\n  }\n\n  constructor() {\n    const reanimatedModule = nativeShouldBeMock()\n      ? JSPropUpdater._reanimatedModuleMock\n      : NativeModules.ReanimatedModule;\n\n    this._reanimatedEventEmitter = new NativeEventEmitter(reanimatedModule);\n  }\n\n  public addOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    const viewTag = getViewTagForComponent(animatedComponent);\n\n    JSPropUpdater._tagToComponentMapping.set(viewTag, animatedComponent);\n    if (JSPropUpdater._tagToComponentMapping.size === 1) {\n      this._reanimatedEventEmitter.addListener(\n        'onReanimatedPropsChange',\n        JSPropUpdater._listener\n      );\n    }\n  }\n\n  public removeOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    const viewTag = getViewTagForComponent(animatedComponent);\n\n    JSPropUpdater._tagToComponentMapping.delete(viewTag);\n    if (JSPropUpdater._tagToComponentMapping.size === 0) {\n      this._reanimatedEventEmitter.removeAllListeners(\n        'onReanimatedPropsChange'\n      );\n    }\n  }\n}\n"],"mappings":"AAAA,YAAY;;AAAC,SAAAA,gBAAAC,GAAA,EAAAC,GAAA,EAAAC,KAAA,IAAAD,GAAA,GAAAE,cAAA,CAAAF,GAAA,OAAAA,GAAA,IAAAD,GAAA,IAAAI,MAAA,CAAAC,cAAA,CAAAL,GAAA,EAAAC,GAAA,IAAAC,KAAA,EAAAA,KAAA,EAAAI,UAAA,QAAAC,YAAA,QAAAC,QAAA,oBAAAR,GAAA,CAAAC,GAAA,IAAAC,KAAA,WAAAF,GAAA;AAAA,SAAAG,eAAAM,GAAA,QAAAR,GAAA,GAAAS,YAAA,CAAAD,GAAA,2BAAAR,GAAA,gBAAAA,GAAA,GAAAU,MAAA,CAAAV,GAAA;AAAA,SAAAS,aAAAE,KAAA,EAAAC,IAAA,eAAAD,KAAA,iBAAAA,KAAA,kBAAAA,KAAA,MAAAE,IAAA,GAAAF,KAAA,CAAAG,MAAA,CAAAC,WAAA,OAAAF,IAAA,KAAAG,SAAA,QAAAC,GAAA,GAAAJ,IAAA,CAAAK,IAAA,CAAAP,KAAA,EAAAC,IAAA,2BAAAK,GAAA,sBAAAA,GAAA,YAAAE,SAAA,4DAAAP,IAAA,gBAAAF,MAAA,GAAAU,MAAA,EAAAT,KAAA;AACb,SACEU,kBAAkB,EAClBC,aAAa,EACbC,cAAc,QACT,cAAc;AACrB,SAASC,KAAK,EAAEC,kBAAkB,QAAQ,gCAAgC;AAkB1E,MAAMC,MAAM,GAAGF,KAAK,EAAE;AAEtB,SAASG,sBAAsBA,CAC7BC,iBAAwC,EACxC;EACA,OAAOF,MAAM,GACRE,iBAAiB,CAAgCC,UAAU,GAC5DN,cAAc,CAACK,iBAAiB,CAAC;AACvC;AAEA,OAAO,MAAME,aAAa,CAA2B;EAYnD,OAAeC,SAASA,CAACC,IAAkB,EAAE;IAC3C,MAAMC,SAAS,GAAGH,aAAa,CAACI,sBAAsB,CAACC,GAAG,CAACH,IAAI,CAACI,OAAO,CAAC;IACxEH,SAAS,IAAIA,SAAS,CAACI,iBAAiB,CAACL,IAAI,CAACM,KAAK,CAAC;EACtD;EAEAC,WAAWA,CAAA,EAAG;IAAAzC,eAAA;IACZ,MAAM0C,gBAAgB,GAAGf,kBAAkB,EAAE,GACzCK,aAAa,CAACW,qBAAqB,GACnCnB,aAAa,CAACoB,gBAAgB;IAElC,IAAI,CAACC,uBAAuB,GAAG,IAAItB,kBAAkB,CAACmB,gBAAgB,CAAC;EACzE;EAEOI,0BAA0BA,CAC/BhB,iBAG4B,EAC5B;IACA,MAAMQ,OAAO,GAAGT,sBAAsB,CAACC,iBAAiB,CAAC;IAEzDE,aAAa,CAACI,sBAAsB,CAACW,GAAG,CAACT,OAAO,EAAER,iBAAiB,CAAC;IACpE,IAAIE,aAAa,CAACI,sBAAsB,CAACY,IAAI,KAAK,CAAC,EAAE;MACnD,IAAI,CAACH,uBAAuB,CAACI,WAAW,CACtC,yBAAyB,EACzBjB,aAAa,CAACC,SAAS,CACxB;IACH;EACF;EAEOiB,6BAA6BA,CAClCpB,iBAG4B,EAC5B;IACA,MAAMQ,OAAO,GAAGT,sBAAsB,CAACC,iBAAiB,CAAC;IAEzDE,aAAa,CAACI,sBAAsB,CAACe,MAAM,CAACb,OAAO,CAAC;IACpD,IAAIN,aAAa,CAACI,sBAAsB,CAACY,IAAI,KAAK,CAAC,EAAE;MACnD,IAAI,CAACH,uBAAuB,CAACO,kBAAkB,CAC7C,yBAAyB,CAC1B;IACH;EACF;AACF;AAACpD,eAAA,CAzDYgC,aAAa,4BACgB,IAAIqB,GAAG,EAAE;AAAArD,eAAA,CADtCgC,aAAa,2BAGe;EACrC,MAAMiB,WAAWA,CAAA,EAAkB;IACjC;EAAA,CACD;EACD,MAAMK,eAAeA,CAAA,EAAkB;IACrC;EAAA;AAEJ,CAAC"}