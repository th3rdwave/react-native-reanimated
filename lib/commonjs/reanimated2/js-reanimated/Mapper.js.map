{"version":3,"names":["Mapper","constructor","module","mapper","inputs","outputs","id","MAPPER_ID","extractMutablesFromArray","markDirty","dirty","maybeRequestRender","forEach","input","addListener","execute","array","res","extractMutables","value","MutableValue","push","Array","isArray","v","Object","keys","key"],"sources":["Mapper.ts"],"sourcesContent":["import { NestedObjectValues } from '../commonTypes';\nimport { JSReanimated } from './commonTypes';\nimport MutableValue from './MutableValue';\n\nexport default class Mapper<T> {\n  static MAPPER_ID = 1;\n  id: number;\n  inputs: MutableValue<T>[];\n  outputs: MutableValue<T>[];\n  mapper: () => void;\n\n  dirty = true;\n\n  constructor(\n    module: JSReanimated,\n    mapper: () => void,\n    inputs: NestedObjectValues<MutableValue<T>>[] = [],\n    outputs: NestedObjectValues<MutableValue<T>>[] = []\n  ) {\n    this.id = Mapper.MAPPER_ID++;\n    this.inputs = this.extractMutablesFromArray(inputs);\n    this.outputs = this.extractMutablesFromArray(outputs);\n    this.mapper = mapper;\n\n    const markDirty = () => {\n      this.dirty = true;\n      module.maybeRequestRender();\n    };\n\n    this.inputs.forEach((input) => {\n      input.addListener(markDirty);\n    });\n  }\n\n  execute(): void {\n    this.dirty = false;\n    this.mapper();\n  }\n\n  extractMutablesFromArray<T>(\n    array: NestedObjectValues<MutableValue<T>>\n  ): MutableValue<T>[] {\n    const res: MutableValue<T>[] = [];\n\n    function extractMutables(value: NestedObjectValues<MutableValue<T>>) {\n      if (value == null) {\n        // return;\n      } else if (value instanceof MutableValue) {\n        res.push(value);\n      } else if (Array.isArray(value)) {\n        value.forEach((v) => extractMutables(v));\n      } else if (typeof value === 'object') {\n        Object.keys(value).forEach((key) => {\n          extractMutables(value[key]);\n        });\n      }\n    }\n\n    extractMutables(array);\n    return res;\n  }\n}\n"],"mappings":";;;;;;;AAEA;;;;;;AAEe,MAAMA,MAAN,CAAgB;EAS7BC,WAAW,CACTC,MADS,EAETC,MAFS,EAKT;IAAA,IAFAC,MAEA,uEAFgD,EAEhD;IAAA,IADAC,OACA,uEADiD,EACjD;;IAAA;;IAAA;;IAAA;;IAAA;;IAAA,+BAPM,IAON;;IACA,KAAKC,EAAL,GAAUN,MAAM,CAACO,SAAP,EAAV;IACA,KAAKH,MAAL,GAAc,KAAKI,wBAAL,CAA8BJ,MAA9B,CAAd;IACA,KAAKC,OAAL,GAAe,KAAKG,wBAAL,CAA8BH,OAA9B,CAAf;IACA,KAAKF,MAAL,GAAcA,MAAd;;IAEA,MAAMM,SAAS,GAAG,MAAM;MACtB,KAAKC,KAAL,GAAa,IAAb;MACAR,MAAM,CAACS,kBAAP;IACD,CAHD;;IAKA,KAAKP,MAAL,CAAYQ,OAAZ,CAAqBC,KAAD,IAAW;MAC7BA,KAAK,CAACC,WAAN,CAAkBL,SAAlB;IACD,CAFD;EAGD;;EAEDM,OAAO,GAAS;IACd,KAAKL,KAAL,GAAa,KAAb;IACA,KAAKP,MAAL;EACD;;EAEDK,wBAAwB,CACtBQ,KADsB,EAEH;IACnB,MAAMC,GAAsB,GAAG,EAA/B;;IAEA,SAASC,eAAT,CAAyBC,KAAzB,EAAqE;MACnE,IAAIA,KAAK,IAAI,IAAb,EAAmB,CACjB;MACD,CAFD,MAEO,IAAIA,KAAK,YAAYC,qBAArB,EAAmC;QACxCH,GAAG,CAACI,IAAJ,CAASF,KAAT;MACD,CAFM,MAEA,IAAIG,KAAK,CAACC,OAAN,CAAcJ,KAAd,CAAJ,EAA0B;QAC/BA,KAAK,CAACP,OAAN,CAAeY,CAAD,IAAON,eAAe,CAACM,CAAD,CAApC;MACD,CAFM,MAEA,IAAI,OAAOL,KAAP,KAAiB,QAArB,EAA+B;QACpCM,MAAM,CAACC,IAAP,CAAYP,KAAZ,EAAmBP,OAAnB,CAA4Be,GAAD,IAAS;UAClCT,eAAe,CAACC,KAAK,CAACQ,GAAD,CAAN,CAAf;QACD,CAFD;MAGD;IACF;;IAEDT,eAAe,CAACF,KAAD,CAAf;IACA,OAAOC,GAAP;EACD;;AAxD4B;;;;gBAAVjB,M,eACA,C"}