{"version":3,"names":["dummyListener","flattenArray","array","Array","isArray","resultArr","_flattenArray","arr","forEach","item","push","onlyAnimatedStyles","styles","filter","style","viewDescriptors","isSameAnimatedStyle","style1","style2","viewsRef","isSameAnimatedProps","has","key","x","undefined","createAnimatedComponent","Component","options","invariant","prototype","isReactComponent","AnimatedComponent","React","constructor","props","value","setAndForwardRef","getForwardedRef","forwardedRef","setLocalRef","ref","tag","findNodeHandle","layout","entering","exiting","shouldBeUseWeb","enableLayoutAnimations","DefaultLayout","DefaultEntering","DefaultExiting","build","config","sv","runOnUI","global","LayoutAnimationRepository","registerConfig","_component","isJest","animatedStyle","makeMutable","componentWillUnmount","_detachNativeEvents","_detachStyles","componentDidMount","_attachNativeEvents","_attachAnimatedStyles","viewTag","prop","current","WorkletEventHandler","registerForEvents","unregisterFromEvents","Platform","OS","_styles","remove","_viewTag","animatedProps","_IS_FABRIC","shadowNodeWrapper","getShadowNodeWrapperFromRef","_removeShadowNodeFromRegistry","_reattachNativeEvents","prevProps","reattachNeeded","_updateFromNative","setNativeProps","prevStyles","prevAnimatedProps","_animatedProps","viewName","hostInstance","RNRenderer","findHostInstance_DEPRECATED","Error","_nativeTag","viewConfig","uiViewClassName","hasReanimated2Props","length","adaptViewConfig","hasOneSameStyle","prevStyle","isPresent","some","add","name","initial","componentDidUpdate","_filterNonAnimatedProps","inputProps","styleProp","processedStyle","map","_isFirstRender","initialStyle","initialUpdaterRun","updater","StyleSheet","flatten","animatedProp","Object","keys","eventNames","eventName","listeners","isChromeDebugger","render","platformProps","select","web","default","collapsable","_setComponentRef","displayName","forwardRef"],"sources":["createAnimatedComponent.tsx"],"sourcesContent":["import React, { Component, ComponentType, MutableRefObject, Ref } from 'react';\nimport { findNodeHandle, Platform, StyleSheet } from 'react-native';\nimport WorkletEventHandler from './reanimated2/WorkletEventHandler';\nimport setAndForwardRef from './setAndForwardRef';\nimport './reanimated2/layoutReanimation/LayoutAnimationRepository';\nimport invariant from 'invariant';\nimport { adaptViewConfig } from './ConfigHelper';\nimport { RNRenderer } from './reanimated2/platform-specific/RNRenderer';\nimport {\n  makeMutable,\n  runOnUI,\n  enableLayoutAnimations,\n} from './reanimated2/core';\nimport {\n  DefaultEntering,\n  DefaultExiting,\n  DefaultLayout,\n} from './reanimated2/layoutReanimation/defaultAnimations/Default';\nimport {\n  isJest,\n  isChromeDebugger,\n  shouldBeUseWeb,\n} from './reanimated2/PlatformChecker';\nimport { initialUpdaterRun } from './reanimated2/animation';\nimport {\n  BaseAnimationBuilder,\n  EntryExitAnimationFunction,\n  ILayoutAnimationBuilder,\n} from './reanimated2/layoutReanimation';\nimport {\n  SharedValue,\n  StyleProps,\n  ShadowNodeWrapper,\n} from './reanimated2/commonTypes';\nimport {\n  ViewDescriptorsSet,\n  ViewRefSet,\n} from './reanimated2/ViewDescriptorsSet';\nimport { getShadowNodeWrapperFromRef } from './reanimated2/fabricUtils';\n\nfunction dummyListener() {\n  // empty listener we use to assign to listener properties for which animated\n  // event is used.\n}\n\ntype NestedArray<T> = T | NestedArray<T>[];\nfunction flattenArray<T>(array: NestedArray<T>): T[] {\n  if (!Array.isArray(array)) {\n    return [array];\n  }\n  const resultArr: T[] = [];\n\n  const _flattenArray = (arr: NestedArray<T>[]): void => {\n    arr.forEach((item) => {\n      if (Array.isArray(item)) {\n        _flattenArray(item);\n      } else {\n        resultArr.push(item);\n      }\n    });\n  };\n  _flattenArray(array);\n  return resultArr;\n}\n\nfunction onlyAnimatedStyles(styles: StyleProps[]) {\n  return styles.filter((style) => style?.viewDescriptors);\n}\n\nfunction isSameAnimatedStyle(\n  style1?: StyleProps,\n  style2?: StyleProps\n): boolean {\n  // We cannot use equality check to compare useAnimatedStyle outputs directly.\n  // Instead, we can compare its viewsRefs.\n  return style1?.viewsRef === style2?.viewsRef;\n}\n\nconst isSameAnimatedProps = isSameAnimatedStyle;\n\nconst has = <K extends string>(\n  key: K,\n  x: unknown\n): x is { [key in K]: unknown } => {\n  if (typeof x === 'function' || typeof x === 'object') {\n    if (x === null || x === undefined) {\n      return false;\n    } else {\n      return key in x;\n    }\n  }\n  return false;\n};\n\ninterface AnimatedProps extends Record<string, unknown> {\n  viewDescriptors?: ViewDescriptorsSet;\n  viewsRef?: ViewRefSet<unknown>;\n  initial?: SharedValue<StyleProps>;\n}\n\nexport type AnimatedComponentProps<P extends Record<string, unknown>> = P & {\n  forwardedRef?: Ref<Component>;\n  style?: NestedArray<StyleProps>;\n  animatedProps?: Partial<AnimatedComponentProps<AnimatedProps>>;\n  animatedStyle?: StyleProps;\n  layout?:\n    | BaseAnimationBuilder\n    | ILayoutAnimationBuilder\n    | typeof BaseAnimationBuilder;\n  entering?:\n    | BaseAnimationBuilder\n    | typeof BaseAnimationBuilder\n    | EntryExitAnimationFunction\n    | Keyframe;\n  exiting?:\n    | BaseAnimationBuilder\n    | typeof BaseAnimationBuilder\n    | EntryExitAnimationFunction\n    | Keyframe;\n};\n\ntype Options<P> = {\n  setNativeProps: (ref: ComponentRef, props: P) => void;\n};\n\ninterface ComponentRef extends Component {\n  setNativeProps?: (props: Record<string, unknown>) => void;\n  getScrollableNode?: () => ComponentRef;\n}\n\nexport interface InitialComponentProps extends Record<string, unknown> {\n  ref?: Ref<Component>;\n  collapsable?: boolean;\n}\n\nexport default function createAnimatedComponent(\n  Component: ComponentType<InitialComponentProps>,\n  options?: Options<InitialComponentProps>\n): ComponentType<AnimatedComponentProps<InitialComponentProps>> {\n  invariant(\n    typeof Component !== 'function' ||\n      (Component.prototype && Component.prototype.isReactComponent),\n    '`createAnimatedComponent` does not support stateless functional components; ' +\n      'use a class component instead.'\n  );\n\n  class AnimatedComponent extends React.Component<\n    AnimatedComponentProps<InitialComponentProps>\n  > {\n    _styles: StyleProps[] | null = null;\n    _animatedProps?: Partial<AnimatedComponentProps<AnimatedProps>>;\n    _viewTag = -1;\n    _isFirstRender = true;\n    animatedStyle: { value: StyleProps } = { value: {} };\n    initialStyle = {};\n    sv: SharedValue<null | Record<string, unknown>> | null;\n    _component: ComponentRef | null = null;\n    static displayName: string;\n\n    constructor(props: AnimatedComponentProps<InitialComponentProps>) {\n      super(props);\n      if (isJest()) {\n        this.animatedStyle = { value: {} };\n      }\n      this.sv = makeMutable({});\n    }\n\n    componentWillUnmount() {\n      this._detachNativeEvents();\n      this._detachStyles();\n      this.sv = null;\n    }\n\n    componentDidMount() {\n      this._attachNativeEvents();\n      this._attachAnimatedStyles();\n    }\n\n    _attachNativeEvents() {\n      const viewTag = findNodeHandle(this);\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler\n        ) {\n          prop.current.registerForEvents(viewTag as number, key);\n        }\n      }\n    }\n\n    _detachNativeEvents() {\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler\n        ) {\n          prop.current.unregisterFromEvents();\n        }\n      }\n    }\n\n    _detachStyles() {\n      if (Platform.OS === 'web' && this._styles !== null) {\n        for (const style of this._styles) {\n          if (style?.viewsRef) {\n            style.viewsRef.remove(this);\n          }\n        }\n      } else if (this._viewTag !== -1 && this._styles !== null) {\n        for (const style of this._styles) {\n          style.viewDescriptors.remove(this._viewTag);\n        }\n        if (this.props.animatedProps?.viewDescriptors) {\n          this.props.animatedProps.viewDescriptors.remove(this._viewTag);\n        }\n        if (global._IS_FABRIC) {\n          const shadowNodeWrapper = getShadowNodeWrapperFromRef(this);\n          runOnUI(() => {\n            'worklet';\n            _removeShadowNodeFromRegistry(shadowNodeWrapper);\n          })();\n        }\n      }\n    }\n\n    _reattachNativeEvents(\n      prevProps: AnimatedComponentProps<InitialComponentProps>\n    ) {\n      let viewTag: number | undefined;\n\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler\n        ) {\n          if (viewTag === undefined) {\n            viewTag = prop.current.viewTag;\n          }\n        }\n      }\n      for (const key in prevProps) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler &&\n          prop.current.reattachNeeded\n        ) {\n          prop.current.unregisterFromEvents();\n        }\n      }\n\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler &&\n          prop.current.reattachNeeded\n        ) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          prop.current.registerForEvents(viewTag!, key);\n          prop.current.reattachNeeded = false;\n        }\n      }\n    }\n\n    _updateFromNative(props: StyleProps) {\n      if (options?.setNativeProps) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        options.setNativeProps(this._component!, props);\n      } else {\n        // eslint-disable-next-line no-unused-expressions\n        this._component?.setNativeProps?.(props);\n      }\n    }\n\n    _attachAnimatedStyles() {\n      const styles = this.props.style\n        ? onlyAnimatedStyles(flattenArray<StyleProps>(this.props.style))\n        : [];\n      const prevStyles = this._styles;\n      this._styles = styles;\n\n      const prevAnimatedProps = this._animatedProps;\n      this._animatedProps = this.props.animatedProps;\n\n      let viewTag: number | null;\n      let viewName: string | null;\n      let shadowNodeWrapper: ShadowNodeWrapper | null = null;\n      if (Platform.OS === 'web') {\n        viewTag = findNodeHandle(this);\n        viewName = null;\n        shadowNodeWrapper = null;\n      } else {\n        // hostInstance can be null for a component that doesn't render anything (render function returns null). Example: svg Stop: https://github.com/react-native-svg/react-native-svg/blob/develop/src/elements/Stop.tsx\n        const hostInstance = RNRenderer.findHostInstance_DEPRECATED(this);\n        if (!hostInstance) {\n          throw new Error(\n            'Cannot find host instance for this component. Maybe it renders nothing?'\n          );\n        }\n        // we can access view tag in the same way it's accessed here https://github.com/facebook/react/blob/e3f4eb7272d4ca0ee49f27577156b57eeb07cf73/packages/react-native-renderer/src/ReactFabric.js#L146\n        viewTag = hostInstance?._nativeTag;\n        /**\n         * RN uses viewConfig for components for storing different properties of the component(example: https://github.com/facebook/react-native/blob/master/Libraries/Components/ScrollView/ScrollViewViewConfig.js#L16).\n         * The name we're looking for is in the field named uiViewClassName.\n         */\n        viewName = hostInstance?.viewConfig?.uiViewClassName;\n        // update UI props whitelist for this view\n        const hasReanimated2Props =\n          this.props.animatedProps?.viewDescriptors || styles.length;\n        if (hasReanimated2Props && hostInstance?.viewConfig) {\n          adaptViewConfig(hostInstance.viewConfig);\n        }\n\n        if (global._IS_FABRIC) {\n          shadowNodeWrapper = getShadowNodeWrapperFromRef(this);\n        }\n      }\n      this._viewTag = viewTag as number;\n\n      // remove old styles\n      if (prevStyles) {\n        // in most of the cases, views have only a single animated style and it remains unchanged\n        const hasOneSameStyle =\n          styles.length === 1 &&\n          prevStyles.length === 1 &&\n          isSameAnimatedStyle(styles[0], prevStyles[0]);\n\n        if (!hasOneSameStyle) {\n          // otherwise, remove each style that is not present in new styles\n          for (const prevStyle of prevStyles) {\n            const isPresent = styles.some((style) =>\n              isSameAnimatedStyle(style, prevStyle)\n            );\n            if (!isPresent) {\n              prevStyle.viewDescriptors.remove(viewTag);\n            }\n          }\n        }\n      }\n\n      styles.forEach((style) => {\n        style.viewDescriptors.add({\n          tag: viewTag,\n          name: viewName,\n          shadowNodeWrapper,\n        });\n        if (isJest()) {\n          /**\n           * We need to connect Jest's TestObject instance whose contains just props object\n           * with the updateProps() function where we update the properties of the component.\n           * We can't update props object directly because TestObject contains a copy of props - look at render function:\n           * const props = this._filterNonAnimatedProps(this.props);\n           */\n          this.animatedStyle.value = {\n            ...this.animatedStyle.value,\n            ...style.initial.value,\n          };\n          style.animatedStyle.current = this.animatedStyle;\n        }\n      });\n\n      // detach old animatedProps\n      if (\n        prevAnimatedProps &&\n        !isSameAnimatedProps(prevAnimatedProps, this.props.animatedProps)\n      ) {\n        prevAnimatedProps.viewDescriptors!.remove(viewTag as number);\n      }\n\n      // attach animatedProps property\n      if (this.props.animatedProps?.viewDescriptors) {\n        this.props.animatedProps.viewDescriptors.add({\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          tag: viewTag!,\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          name: viewName!,\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          shadowNodeWrapper: shadowNodeWrapper!,\n        });\n      }\n    }\n\n    componentDidUpdate(\n      prevProps: AnimatedComponentProps<InitialComponentProps>\n    ) {\n      this._reattachNativeEvents(prevProps);\n      this._attachAnimatedStyles();\n    }\n\n    _setComponentRef = setAndForwardRef<Component>({\n      getForwardedRef: () =>\n        this.props.forwardedRef as MutableRefObject<\n          Component<Record<string, unknown>, Record<string, unknown>, unknown>\n        >,\n      setLocalRef: (ref) => {\n        // TODO update config\n        const tag = findNodeHandle(ref);\n        if (\n          (this.props.layout || this.props.entering || this.props.exiting) &&\n          tag != null\n        ) {\n          if (!shouldBeUseWeb()) {\n            enableLayoutAnimations(true, false);\n          }\n          let layout = this.props.layout ? this.props.layout : DefaultLayout;\n          let entering = this.props.entering\n            ? this.props.entering\n            : DefaultEntering;\n          let exiting = this.props.exiting\n            ? this.props.exiting\n            : DefaultExiting;\n\n          if (has('build', layout)) {\n            layout = layout.build();\n          }\n\n          if (has('build', entering)) {\n            entering = entering.build() as EntryExitAnimationFunction;\n          }\n\n          if (has('build', exiting)) {\n            exiting = exiting.build() as EntryExitAnimationFunction;\n          }\n\n          const config = {\n            layout,\n            entering,\n            exiting,\n            sv: this.sv,\n          };\n          runOnUI(() => {\n            'worklet';\n            global.LayoutAnimationRepository.registerConfig(tag, config);\n          })();\n        }\n\n        if (ref !== this._component) {\n          this._component = ref;\n        }\n      },\n    });\n\n    _filterNonAnimatedProps(\n      inputProps: AnimatedComponentProps<InitialComponentProps>\n    ): Record<string, unknown> {\n      const props: Record<string, unknown> = {};\n      for (const key in inputProps) {\n        const value = inputProps[key];\n        if (key === 'style') {\n          const styleProp = inputProps.style;\n          const styles = flattenArray<StyleProps>(styleProp ?? []);\n          const processedStyle: StyleProps = styles.map((style) => {\n            if (style && style.viewDescriptors) {\n              // this is how we recognize styles returned by useAnimatedStyle\n              style.viewsRef.add(this);\n              if (this._isFirstRender) {\n                this.initialStyle = {\n                  ...style.initial.value,\n                  ...initialUpdaterRun<StyleProps>(style.initial.updater),\n                };\n              }\n              return this.initialStyle;\n            } else {\n              return style;\n            }\n          });\n          props[key] = StyleSheet.flatten(processedStyle);\n        } else if (key === 'animatedProps') {\n          const animatedProp = inputProps.animatedProps as Partial<\n            AnimatedComponentProps<AnimatedProps>\n          >;\n          if (animatedProp.initial !== undefined) {\n            Object.keys(animatedProp.initial.value).forEach((key) => {\n              props[key] = animatedProp.initial?.value[key];\n              animatedProp.viewsRef?.add(this);\n            });\n          }\n        } else if (\n          has('current', value) &&\n          value.current instanceof WorkletEventHandler\n        ) {\n          if (value.current.eventNames.length > 0) {\n            value.current.eventNames.forEach((eventName) => {\n              props[eventName] = has('listeners', value.current)\n                ? (value.current.listeners as Record<string, unknown>)[\n                    eventName\n                  ]\n                : dummyListener;\n            });\n          } else {\n            props[key] = dummyListener;\n          }\n        } else if (\n          key !== 'onGestureHandlerStateChange' ||\n          !isChromeDebugger()\n        ) {\n          props[key] = value;\n        }\n      }\n      return props;\n    }\n\n    render() {\n      const props = this._filterNonAnimatedProps(this.props);\n      if (isJest()) {\n        props.animatedStyle = this.animatedStyle;\n      }\n\n      if (this._isFirstRender) {\n        this._isFirstRender = false;\n      }\n\n      const platformProps = Platform.select({\n        web: {},\n        default: { collapsable: false },\n      });\n      return (\n        <Component {...props} ref={this._setComponentRef} {...platformProps} />\n      );\n    }\n  }\n\n  AnimatedComponent.displayName = `AnimatedComponent(${\n    Component.displayName || Component.name || 'Component'\n  })`;\n\n  return React.forwardRef<Component>((props, ref) => {\n    return (\n      <AnimatedComponent\n        {...props}\n        {...(ref === null ? null : { forwardedRef: ref })}\n      />\n    );\n  });\n}\n"],"mappings":"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"}